<div class="flex justify-center items-center coverparentspace bg-gradient-to-br from-slate-900 via-blue-900 to-slate-800 min-h-screen">
  <div
    class="max-w-md w-full rounded-2xl bg-white/10 backdrop-blur-xl p-8 leading-5 text-white shadow-2xl border border-white/20"
    *ngIf="!loading; else loader"
  >
    <ng-container *ngIf="showGeneratePINForm; else changePINForm">
      <!-- Generate PIN Form -->
      <div class="flex items-center justify-center mb-8">
        <div class="w-12 h-12 bg-gradient-to-br from-blue-400 to-cyan-300 rounded-full flex items-center justify-center shadow-lg">
          <i class="fas fa-lock text-xl text-slate-900"></i>
        </div>
      </div>
      <h2 class="text-3xl font-bold mb-2 text-center bg-gradient-to-r from-blue-400 to-cyan-300 bg-clip-text text-transparent">Tạo PIN</h2>
      <p class="text-center text-blue-200 text-sm mb-6">Tạo PIN bảo mật cho tài khoản của bạn</p>
      <form
        [formGroup]="pinChangeForm"
        (ngSubmit)="onSubmitGeneratePIN()"
        class="space-y-5"
      >
        <div>
          <label for="newPinGenerate" class="block text-sm font-semibold mb-3 text-blue-100">PIN mới (4 chữ số):</label>
          <input
            formControlName="newPin"
            type="password"
            id="newPinGenerate"
            class="w-full px-4 py-3 bg-white/10 border border-white/30 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-transparent text-white placeholder-blue-200/50 transition-all"
            placeholder="••••"
          />
          <div
            *ngIf="
              pinChangeForm.get('newPin')?.invalid &&
              pinChangeForm.get('newPin')?.touched
            "
            class="text-red-300 text-sm mt-2 flex items-center"
          >
            <i class="fas fa-exclamation-circle mr-2"></i>PIN phải có 4 chữ số
          </div>
        </div>

        <div>
          <label for="confirmPinGenerate" class="block text-sm font-semibold mb-3 text-blue-100">Xác nhận PIN:</label>
          <input
            formControlName="confirmPin"
            type="password"
            id="confirmPinGenerate"
            class="w-full px-4 py-3 bg-white/10 border border-white/30 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-transparent text-white placeholder-blue-200/50 transition-all"
            placeholder="••••"
          />
          <div
            *ngIf="
              pinChangeForm.get('confirmPin')?.invalid &&
              pinChangeForm.get('confirmPin')?.touched
            "
            class="text-red-300 text-sm mt-2 flex items-center"
          >
            <i class="fas fa-exclamation-circle mr-2"></i>
            <div>
              <div *ngIf="pinChangeForm.get('confirmPin')?.errors?.required">PIN xác nhận là bắt buộc</div>
              <div *ngIf="pinChangeForm.get('confirmPin')?.errors?.mismatch">PIN không khớp</div>
            </div>
          </div>
        </div>

        <div>
          <label for="passwordGenerate" class="block text-sm font-semibold mb-3 text-blue-100">Mật khẩu:</label>
          <input
            formControlName="password"
            type="password"
            id="passwordGenerate"
            class="w-full px-4 py-3 bg-white/10 border border-white/30 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-transparent text-white placeholder-blue-200/50 transition-all"
            placeholder="••••••••"
          />
          <div
            *ngIf="
              pinChangeForm.get('password')?.invalid &&
              pinChangeForm.get('password')?.touched
            "
            class="text-red-300 text-sm mt-2 flex items-center"
          >
            <i class="fas fa-exclamation-circle mr-2"></i>Mật khẩu là bắt buộc
          </div>
        </div>

        <button
          type="submit"
          [disabled]="pinChangeForm.invalid"
          class="w-full mt-6 bg-gradient-to-r from-blue-500 to-cyan-500 hover:from-blue-600 hover:to-cyan-600 text-white font-bold py-3 px-6 rounded-lg focus:outline-none disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-300 shadow-lg hover:shadow-blue-500/50"
        >
          <i class="fas fa-check-circle mr-2"></i>Tạo PIN
        </button>
      </form>
    </ng-container>

    <ng-template #changePINForm>
      <!-- Change PIN Form -->
      <div class="flex items-center justify-center mb-8">
        <div class="w-12 h-12 bg-gradient-to-br from-blue-400 to-cyan-300 rounded-full flex items-center justify-center shadow-lg">
          <i class="fas fa-key text-xl text-slate-900"></i>
        </div>
      </div>
      <h2 class="text-3xl font-bold mb-2 text-center bg-gradient-to-r from-blue-400 to-cyan-300 bg-clip-text text-transparent">Đổi PIN</h2>
      <p class="text-center text-blue-200 text-sm mb-6">Cập nhật PIN bảo mật của tài khoản</p>
      <form
        [formGroup]="pinChangeForm"
        (ngSubmit)="onSubmitChangePIN()"
        class="space-y-5"
      >
        <div>
          <label for="newPinChange" class="block text-sm font-semibold mb-3 text-blue-100">PIN mới (4 chữ số):</label>
          <input
            formControlName="newPin"
            type="password"
            id="newPinChange"
            class="w-full px-4 py-3 bg-white/10 border border-white/30 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-transparent text-white placeholder-blue-200/50 transition-all"
            placeholder="••••"
          />
          <div
            *ngIf="
              pinChangeForm.get('newPin')?.invalid &&
              pinChangeForm.get('newPin')?.touched
            "
            class="text-red-300 text-sm mt-2 flex items-center"
          >
            <i class="fas fa-exclamation-circle mr-2"></i>PIN phải có 4 chữ số
          </div>
        </div>

        <div>
          <label for="confirmPinChange" class="block text-sm font-semibold mb-3 text-blue-100">Xác nhận PIN:</label>
          <input
            formControlName="confirmPin"
            type="password"
            id="confirmPinChange"
            class="w-full px-4 py-3 bg-white/10 border border-white/30 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-transparent text-white placeholder-blue-200/50 transition-all"
            placeholder="••••"
          />
          <div
            *ngIf="
              pinChangeForm.get('confirmPin')?.invalid &&
              pinChangeForm.get('confirmPin')?.touched
            "
            class="text-red-300 text-sm mt-2 flex items-center"
          >
            <i class="fas fa-exclamation-circle mr-2"></i>
            <div>
              <div *ngIf="pinChangeForm.get('confirmPin')?.errors?.required">PIN xác nhận là bắt buộc</div>
              <div *ngIf="pinChangeForm.get('confirmPin')?.errors?.mismatch">PIN không khớp</div>
            </div>
          </div>
        </div>

        <div>
          <label for="passwordChange" class="block text-sm font-semibold mb-3 text-blue-100">Mật khẩu:</label>
          <input
            formControlName="password"
            type="password"
            id="passwordChange"
            class="w-full px-4 py-3 bg-white/10 border border-white/30 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-transparent text-white placeholder-blue-200/50 transition-all"
            placeholder="••••••••"
          />
          <div
            *ngIf="
              pinChangeForm.get('password')?.invalid &&
              pinChangeForm.get('password')?.touched
            "
            class="text-red-300 text-sm mt-2 flex items-center"
          >
            <i class="fas fa-exclamation-circle mr-2"></i>Mật khẩu là bắt buộc
          </div>
        </div>

        <button
          type="submit"
          [disabled]="pinChangeForm.invalid"
          class="w-full mt-6 bg-gradient-to-r from-blue-500 to-cyan-500 hover:from-blue-600 hover:to-cyan-600 text-white font-bold py-3 px-6 rounded-lg focus:outline-none disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-300 shadow-lg hover:shadow-blue-500/50"
        >
          <i class="fas fa-refresh mr-2"></i>Cập nhật PIN
        </button>
      </form>
    </ng-template>
  </div>
</div>

<ng-template #loader>
  <div class="flex items-center justify-center h-full">
    <div class="loader">Loading</div>
  </div>
</ng-template>
